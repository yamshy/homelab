# InfisicalSecret for media secrets in media namespace
# Reference: https://infisical.com/docs/integrations/platforms/kubernetes/infisical-secret-crd
---
apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: media-env
  namespace: media
spec:
  resyncInterval: 60
  authentication:
    universalAuth:
      secretsScope:
        projectSlug: "homelab-0r-b1"
        envSlug: "prod"
        secretsPath: "/"
        recursive: true
      credentialsRef:
        secretName: "universal-auth-credentials"
        secretNamespace: "kube-system"  # Infrastructure credentials
  managedSecretReference:
    secretName: "cluster-secrets"  # Name of resulting Kubernetes secret
    secretNamespace: "media"
    creationPolicy: "Orphan"  # Keep secret if InfisicalSecret is deleted
    template:
      includeAllSecrets: false  # Only include specific secrets
      data:
        # Only include the secrets this app actually needs
        SECRET_TAILNET: "{{ .SECRET_TAILNET.Value }}"
        # VPN credentials for qBittorrent Gluetun sidecar
        WIREGUARD_PRIVATE_KEY: "{{ .WIREGUARD_PRIVATE_KEY.Value }}"
        WIREGUARD_ADDRESSES: "{{ .WIREGUARD_ADDRESSES.Value }}"