---
alwaysApply: false
description: "Overview and context for homelab Kubernetes infrastructure repository using GitOps with Flux and Talos Linux"
globs:
  - "kubernetes/**/*.yaml"
  - "kubernetes/**/*.yml"
  - "talos/**/*.yaml"
  - "talos/**/*.yml"
  - "bootstrap/**/*.yaml"
  - "bootstrap/**/*.yml"
  - "scripts/**/*.sh"
  - "Taskfile.yaml"
  - ".taskfiles/**/*.yaml"
  - ".taskfiles/**/*.yml"

---

# Homelab Kubernetes Infrastructure Overview

## Repository Purpose

This is a **homelab Kubernetes infrastructure** repository that uses GitOps principles with Flux to manage a Talos Linux-based Kubernetes cluster. The repository follows a declarative infrastructure approach where all cluster configuration is stored as code and automatically applied through Flux.

## ğŸ—ï¸ Core Architecture

### Technology Stack

- **Talos Linux**: Minimal, immutable Linux distribution for Kubernetes nodes
- **Flux**: GitOps operator for continuous deployment and cluster management
- **Cilium**: CNI and network policy enforcement
- **cert-manager**: Certificate management for TLS termination
- **Longhorn**: Distributed block storage for persistent volumes
- **External-DNS**: DNS record management with Cloudflare
- **Cloudflare Tunnel**: Secure external access to cluster services

### Directory Structure

```
homelab/
â”œâ”€â”€ bootstrap/           # Initial cluster bootstrap configuration
â”œâ”€â”€ kubernetes/          # Main cluster configuration (Flux-managed)
â”‚   â”œâ”€â”€ apps/           # Application deployments by category
â”‚   â”‚   â”œâ”€â”€ cert-manager/    # Certificate management
â”‚   â”‚   â”œâ”€â”€ default/         # User applications
â”‚   â”‚   â”œâ”€â”€ flux-system/     # Flux operator and instance
â”‚   â”‚   â”œâ”€â”€ kube-system/     # Core system components
â”‚   â”‚   â”œâ”€â”€ network/         # Networking components
â”‚   â”‚   â””â”€â”€ storage/         # Storage solutions
â”‚   â”œâ”€â”€ components/      # Shared components and secrets
â”‚   â””â”€â”€ flux/            # Flux cluster configuration
â”œâ”€â”€ talos/               # Talos Linux configuration
â”œâ”€â”€ scripts/             # Bootstrap and utility scripts
â””â”€â”€ .taskfiles/          # Task definitions for common operations
```

## ğŸš€ Key Workflows

### Development Environment

- **Mise**: Tool version management (`mise install`)
- **Task**: Common operations via [Taskfile.yaml](mdc:Taskfile.yaml)
- **SOPS**: Secret encryption/decryption with age keys

### Common Tasks

```bash
# Install development tools
mise trust
mise install

# Generate Talos configuration
task talos:generate-config

# Bootstrap cluster
task bootstrap:talos
task bootstrap:apps

# Force Flux reconciliation
task reconcile
```

## ğŸ“š Documentation

- [README.md](mdc:README.md) - Complete setup and usage guide
- [AGENTS.md](mdc:AGENTS.md) - Detailed architecture and contribution guidelines
- [Taskfile.yaml](mdc:Taskfile.yaml) - Available automation tasks

## ğŸ”§ Key Patterns

- **GitOps**: All configuration managed through Git with Flux
- **Helm-based**: Applications deployed via HelmReleases
- **Kustomize**: Resource customization and composition
- **SOPS encryption**: Secrets encrypted with age keys
- **Modular structure**: Apps organized by functional category

# Homelab Kubernetes Infrastructure Overview

## Repository Purpose

This is a **homelab Kubernetes infrastructure** repository that uses GitOps principles with Flux to manage a Talos Linux-based Kubernetes cluster. The repository follows a declarative infrastructure approach where all cluster configuration is stored as code and automatically applied through Flux.

## ğŸ—ï¸ Core Architecture

### Technology Stack

- **Talos Linux**: Minimal, immutable Linux distribution for Kubernetes nodes
- **Flux**: GitOps operator for continuous deployment and cluster management
- **Cilium**: CNI and network policy enforcement
- **cert-manager**: Certificate management for TLS termination
- **Longhorn**: Distributed block storage for persistent volumes
- **External-DNS**: DNS record management with Cloudflare
- **Cloudflare Tunnel**: Secure external access to cluster services

### Directory Structure

```
homelab/
â”œâ”€â”€ bootstrap/           # Initial cluster bootstrap configuration
â”œâ”€â”€ kubernetes/          # Main cluster configuration (Flux-managed)
â”‚   â”œâ”€â”€ apps/           # Application deployments by category
â”‚   â”‚   â”œâ”€â”€ cert-manager/    # Certificate management
â”‚   â”‚   â”œâ”€â”€ default/         # User applications
â”‚   â”‚   â”œâ”€â”€ flux-system/     # Flux operator and instance
â”‚   â”‚   â”œâ”€â”€ kube-system/     # Core system components
â”‚   â”‚   â”œâ”€â”€ network/         # Networking components
â”‚   â”‚   â””â”€â”€ storage/         # Storage solutions
â”‚   â”œâ”€â”€ components/      # Shared components and secrets
â”‚   â””â”€â”€ flux/            # Flux cluster configuration
â”œâ”€â”€ talos/               # Talos Linux configuration
â”œâ”€â”€ scripts/             # Bootstrap and utility scripts
â””â”€â”€ .taskfiles/          # Task definitions for common operations
```

## ğŸš€ Key Workflows

### Development Environment

- **Mise**: Tool version management (`mise install`)
- **Task**: Common operations via [Taskfile.yaml](mdc:Taskfile.yaml)
- **SOPS**: Secret encryption/decryption with age keys

### Common Tasks

```bash
# Install development tools
mise trust
mise install

# Generate Talos configuration
task talos:generate-config

# Bootstrap cluster
task bootstrap:talos
task bootstrap:apps

# Force Flux reconciliation
task reconcile
```

## ğŸ“š Documentation

- [README.md](mdc:README.md) - Complete setup and usage guide
- [AGENTS.md](mdc:AGENTS.md) - Detailed architecture and contribution guidelines
- [Taskfile.yaml](mdc:Taskfile.yaml) - Available automation tasks

## ğŸ”§ Key Patterns

- **GitOps**: All configuration managed through Git with Flux
- **Helm-based**: Applications deployed via HelmReleases
- **Kustomize**: Resource customization and composition
- **SOPS encryption**: Secrets encrypted with age keys
- **Modular structure**: Apps organized by functional category
